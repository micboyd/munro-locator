<main class="mx-auto max-w-7xl px-5 py-10 sm:px-8">
    <div class="space-y-6">
        <!-- Simple header -->
        <section class="rounded-2xl bg-zinc-950 p-6 text-white">
            <div class="flex items-start justify-between gap-4">
                <div class="min-w-0">
                    <h2 class="text-2xl font-semibold text-white">Library</h2>
                    <p class="mt-2 text-base text-white/70">Mountains grouped by category.</p>

                    @if (loading) {
                    <p class="mt-2 text-sm font-semibold text-white/70">Loading mountains…</p>
                    }

                    @if (error) {
                    <p class="mt-2 text-sm font-semibold text-red-300">{{ error }}</p>
                    }
                </div>

                <span class="shrink-0 rounded-full bg-white/10 px-4 py-2 text-sm font-semibold text-white/90">
                    <span class="inline-flex items-center gap-2">
                        <i class="fa-solid fa-mountain"></i>
                        {{ totalCount }} total
                    </span>
                </span>
            </div>
        </section>

        <!-- Two-column layout -->
        <section class="grid grid-cols-1 gap-6 lg:grid-cols-12">
            <!-- Categories -->
            <section class="rounded-2xl bg-zinc-100 p-6 lg:col-span-4">
                <header class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                        <span class="grid h-11 w-11 place-items-center rounded-xl bg-white text-zinc-900">
                            <i class="fa-solid fa-layer-group"></i>
                        </span>
                        <div>
                            <h2 class="text-xl font-semibold text-zinc-950">Categories</h2>
                            <div class="mt-1 text-sm font-semibold text-zinc-600">Select one</div>
                        </div>
                    </div>
                </header>

                <div class="mt-6 space-y-3">
                    @if (!loading && !error && categories.length === 0) {
                    <div class="rounded-2xl bg-white p-4 text-sm font-semibold text-zinc-600">
                        No categories to show.
                    </div>
                    }

                    @for (c of categories; track c.key) {
                    <button type="button" (click)="selectCategory(c.key)"
                        class="w-full overflow-hidden rounded-2xl bg-white p-4 text-left transition hover:bg-zinc-50"
                        [class.ring-2]="selectedCategory === c.key" [class.ring-zinc-950]="selectedCategory === c.key"
                        [attr.aria-current]="selectedCategory === c.key ? 'true' : null">
                        <div class="flex items-center justify-between gap-4">
                            <div class="flex min-w-0 items-center gap-3">
                                <span class="grid h-11 w-11 place-items-center rounded-xl"
                                    [class.bg-zinc-950]="selectedCategory === c.key"
                                    [class.text-white]="selectedCategory === c.key"
                                    [class.bg-zinc-100]="selectedCategory !== c.key"
                                    [class.text-zinc-900]="selectedCategory !== c.key">
                                    <i class="fa-solid fa-mountain"></i>
                                </span>

                                <div class="min-w-0">
                                    <div class="truncate text-base font-semibold text-zinc-950">{{ c.label }}</div>
                                    <div class="mt-1 text-sm font-semibold text-zinc-600">{{ c.count }} peaks</div>
                                </div>
                            </div>

                            @if (selectedCategory === c.key) {
                            <span class="shrink-0 rounded-full bg-zinc-950 px-3 py-1 text-xs font-semibold text-white">
                                Selected
                            </span>
                            } @else {
                            <span class="shrink-0 text-sm font-semibold text-zinc-600 group-hover:text-zinc-900">
                                View <i class="fa-solid fa-arrow-right ml-1"></i>
                            </span>
                            }
                        </div>
                    </button>
                    }
                </div>
            </section>

            <!-- Mountain list -->
            <section class="rounded-2xl bg-zinc-100 p-6 lg:col-span-8">
                <header class="flex items-center justify-between gap-4">
                    <div class="flex items-center gap-3">
                        <span class="grid h-11 w-11 place-items-center rounded-xl bg-white text-zinc-900">
                            <i class="fa-solid fa-list"></i>
                        </span>

                        <div>
                            <h2 class="text-xl font-semibold text-zinc-950">{{ selectedCategoryLabel }}</h2>
                            <div class="mt-1 text-sm font-semibold text-zinc-600">{{ selectedMountains.length }} peaks
                            </div>
                        </div>
                    </div>

                    <button class="rounded-3xl bg-zinc-950 px-5 py-3 text-sm font-semibold text-white hover:bg-zinc-900"
                        type="button" [disabled]="loading">
                        <span class="inline-flex items-center gap-2">
                            <i class="fa-solid fa-plus"></i>
                            Add
                        </span>
                    </button>
                </header>

                @if (loading) {
                <div class="mt-6 rounded-2xl bg-white p-6 text-sm font-semibold text-zinc-600">
                    Loading list…
                </div>
                } @else if (!error && selectedMountains.length === 0) {
                <div class="mt-6 rounded-2xl bg-white p-6 text-sm font-semibold text-zinc-600">
                    No mountains in this category.
                </div>
                } @else if (!error) {
                <div class="mt-6 grid grid-cols-1 gap-4 sm:grid-cols-2">
                    @for (m of selectedMountains; track m.name) {
                    <article class="overflow-hidden rounded-2xl bg-white">
                        <div class="relative h-40">
                            <img class="h-full w-full object-cover" [src]="imageOrFallback(m.imageUrl)"
                                [alt]="m.name || 'Mountain'" />
                            <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-black/10 to-transparent">
                            </div>

                            <div class="absolute bottom-4 left-4 right-4">
                                <div class="flex items-end justify-between gap-4">
                                    <div class="min-w-0">
                                        <div class="truncate text-2xl font-semibold text-white">{{ m.name || 'Unnamed
                                            mountain' }}</div>
                                        <div class="mt-1 truncate text-base text-white/80">
                                            {{ (m.region || 'Unknown region') }} • {{ formatHeight(m.height) }}
                                        </div>
                                    </div>

                                    <span
                                        class="shrink-0 rounded-full bg-white/15 px-4 py-2 text-sm font-semibold text-white">
                                        {{ m.country || '—' }}
                                    </span>
                                </div>
                            </div>
                        </div>

                        <div class="p-6">
                            <div class="text-sm font-semibold text-zinc-600">Meaning</div>
                            <div class="mt-1 text-base font-semibold text-zinc-950">{{ m.meaning || '—' }}</div>

                            <div class="mt-4 flex flex-wrap gap-3">
                                <span
                                    class="inline-flex items-center gap-2 rounded-full bg-zinc-100 px-4 py-2 text-sm font-semibold text-zinc-700">
                                    <i class="fa-solid fa-location-dot"></i>
                                    {{ m.region || '—' }}
                                </span>
                                <span
                                    class="inline-flex items-center gap-2 rounded-full bg-zinc-100 px-4 py-2 text-sm font-semibold text-zinc-700">
                                    <i class="fa-solid fa-compass"></i>
                                    {{ formatCoords(m.latitude, m.longitude) }}
                                </span>
                            </div>

                            <div class="mt-6 flex justify-end">
                                <button
                                    class="rounded-3xl bg-zinc-950 px-6 py-3 text-sm font-semibold text-white hover:bg-zinc-900"
                                    type="button">
                                    <span class="inline-flex items-center gap-2">
                                        <i class="fa-solid fa-book-open"></i>
                                        View
                                    </span>
                                </button>
                            </div>
                        </div>
                    </article>
                    }
                </div>
                }
            </section>
        </section>
    </div>
</main>
