<!-- Show loading indicator if munrosLoading -->
@if (munrosLoading) {
<app-loading-indicator></app-loading-indicator>
} @else {
<div class="flex flex-col lg:flex-row h-full">
	<!-- Side One: Munro Manager + List -->
	<div class="w-full lg:w-1/2 px-2 sm:px-4 lg:pr-6 flex flex-col h-[60vh] lg:h-full">
		<!-- Modern header row: Title + Search -->
		<div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 mb-6">
			<h1 class="font-semibold text-2xl sm:text-3xl md:text-4xl">Munro Manager</h1>
			<input
				type="text"
				class="p-4 text-base border border-gray-200 rounded-xl focus:outline-none focus:border-black transition disabled:bg-gray-100"
				placeholder="Search Munros"
				[formControl]="filterControl" />
		</div>

		<!-- Tabs and Munro List -->
		<app-tabs class="flex-1 min-h-0">
			<!-- All Munros -->
			<app-tab-item [title]="allTitle | async" [active]="true">
				<ng-template>
					<div class="overflow-auto h-full min-h-0">
						<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4 sm:gap-6">
							@for (munro of filteredAllMunros$ | async; track munro._id) {
							<div
								class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 relative">
								<div class="relative">
									<img
										[src]="munro.image_url"
										alt="Munro image"
										class="w-full h-40 sm:h-48 object-cover" />
									@if (munro.completed) {
									<span
										class="absolute top-2 left-2 bg-green-800 text-white text-xs sm:text-sm font-medium px-2 sm:px-3 py-1 rounded-full">
										Completed
									</span>
									}
								</div>
								<div class="p-4">
									<div class="flex items-start justify-between mb-2">
										<h2
											class="text-base sm:text-lg font-semibold text-gray-800 break-words max-w-[75%]">
											{{ munro.hill_name }}
										</h2>
										<div class="flex-shrink-0 flex items-center ml-4">
											<a
												[routerLink]="munro._id"
												class="ml-2 transition"
												title="View Munro Details">
												<i class="fa-solid fa-pen-to-square"></i>
											</a>
											<button
												(click)="locateMunro(munro.latitude, munro.longitude)"
												class="ml-3 cursor-pointer">
												<i class="fa-solid fa-location-crosshairs"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							}
						</div>
					</div>
				</ng-template>
			</app-tab-item>

			<!-- Completed Munros -->
			<app-tab-item [title]="allCompletedTitle | async">
				<ng-template>
					<div class="overflow-auto h-full min-h-0">
						<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4 sm:gap-6">
							@for (munro of filteredCompletedMunros$ | async; track munro._id) {
							<div
								class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 relative">
								<div class="relative">
									<img
										[src]="munro.image_url"
										alt="Munro image"
										class="w-full h-40 sm:h-48 object-cover" />
									@if (munro.completed) {
									<span
										class="absolute top-2 left-2 bg-green-800 text-white text-xs sm:text-sm font-medium px-2 sm:px-3 py-1 rounded-full">
										Completed
									</span>
									}
								</div>
								<div class="p-4">
									<div class="flex items-center justify-between mb-2">
										<h2 class="text-base sm:text-lg font-semibold text-gray-800">
											{{ munro.hill_name }}
										</h2>
										<div>
											<a
												[routerLink]="munro._id"
												class="ml-2 transition"
												title="View Munro Details">
												<i class="fa-solid fa-pen-to-square"></i>
											</a>
											<button
												(click)="locateMunro(munro.latitude, munro.longitude)"
												class="ml-3 cursor-pointer">
												<i class="fa-solid fa-location-crosshairs"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							}
						</div>
					</div>
				</ng-template>
			</app-tab-item>

			<!-- Incomplete Munros -->
			<app-tab-item [title]="allIncompleteTitle | async">
				<ng-template>
					<div class="overflow-auto h-full min-h-0">
						<div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-4 sm:gap-6">
							@for (munro of filteredIncompleteMunros$ | async; track munro._id) {
							<div
								class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-lg transition-shadow duration-300 relative">
								<div class="relative">
									<img
										[src]="munro.image_url"
										alt="Munro image"
										class="w-full h-40 sm:h-48 object-cover" />
									@if (munro.completed) {
									<span
										class="absolute top-2 left-2 bg-green-800 text-white text-xs sm:text-sm font-medium px-2 sm:px-3 py-1 rounded-full">
										Completed
									</span>
									}
								</div>
								<div class="p-4">
									<div class="flex items-center justify-between mb-2">
										<h2 class="text-base sm:text-lg font-semibold text-gray-800">
											{{ munro.hill_name }}
										</h2>
										<div>
											<a
												[routerLink]="munro._id"
												class="ml-2 transition"
												title="View Munro Details">
												<i class="fa-solid fa-pen-to-square"></i>
											</a>
											<button
												(click)="locateMunro(munro.latitude, munro.longitude)"
												class="ml-3 cursor-pointer">
												<i class="fa-solid fa-location-crosshairs"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							}
						</div>
					</div>
				</ng-template>
			</app-tab-item>
		</app-tabs>
	</div>

	<!-- Side Two: Blue background / Map -->
	<div class="w-full lg:w-1/2 h-[40vh] lg:h-full flex items-center justify-center mt-4 lg:mt-0 lg:pl-6">
		<app-map
			[viewLocationSetting]="viewLocationSetting"
			[allMunros]="filteredAllMunros$ | async"
			class="h-full w-full rounded-xl"></app-map>
	</div>
</div>
}
