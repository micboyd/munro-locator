@if (munroLoading) {
<app-loading-indicator></app-loading-indicator>
} @else {
<!-- ✅ Width aligned with Mountain Manager / Gallery -->
<div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8">
  <!-- ✅ Flat shell: NO border, NO card shadow, modern spacing -->
  <div class="bg-white rounded-3xl">
    <!-- Header (flat, airy) -->
    <div class="px-0 sm:px-0 pt-1">
      <!-- Back Button (flat pill, no border) -->
      <a class="inline-flex items-center gap-2 text-slate-600 hover:text-slate-900 text-sm font-medium
                 px-3 py-2 rounded-full
                 hover:bg-slate-50 transition w-fit" [routerLink]="['/dashboard/mountain-manager']"
        aria-label="Back to Munro Manager">
        <i class="fa-solid fa-arrow-left-long text-sm"></i>
        <span>Back</span>
      </a>

      <!-- Title row -->
      <div class="mt-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div class="min-w-0 text-center sm:text-left">
          <h1 class="text-2xl sm:text-4xl font-semibold text-slate-900 tracking-tight truncate">
            {{ selectedMunro.hill_name }}
          </h1>
          <p class="mt-1 text-sm text-slate-500">
            {{ selectedMunro.height }}m
          </p>
        </div>

        <div class="flex items-center justify-center sm:justify-end gap-3">
          <img [src]="selectedMunro.image_url" alt="{{ selectedMunro.hill_name }}"
            class="w-16 h-16 sm:w-20 sm:h-20 object-cover rounded-2xl bg-slate-100" />

          <!-- Status badge (flat, no border) -->
          <span class="inline-flex items-center gap-2 text-[12px] font-medium px-3 py-1.5 rounded-full
                     bg-slate-100 text-slate-800">
            <span class="inline-block w-2 h-2 rounded-full" [ngClass]="{
                  'bg-emerald-500': !isNewCompletedMunro,
                  'bg-rose-500': isNewCompletedMunro
                }"></span>
            {{ isNewCompletedMunro ? 'Not complete' : 'Completed' }}
          </span>
        </div>
      </div>
    </div>

    <!-- Content -->
    <div class="mt-8">
      <!-- Edit Mode -->
      @if (editMode) {
      <form [formGroup]="completedMunroForm" class="space-y-7">
        <!-- Notes -->
        <div>
          <label for="notes" class="block text-sm font-medium text-slate-800 mb-2">Notes</label>
          <textarea id="notes" formControlName="notes" class="w-full px-4 py-3 text-sm text-slate-900 placeholder:text-slate-400
                       bg-slate-50 rounded-2xl
                       border-0 ring-1 ring-slate-200
                       focus:outline-none focus:ring-4 focus:ring-slate-900/10 focus:ring-offset-0
                       transition resize-none min-h-[120px]" placeholder="Any notes about your hike..."></textarea>
        </div>

        <!-- Rating -->
        <div>
          <label class="block text-sm font-medium text-slate-800 mb-2">Rating</label>
          <div class="inline-flex items-center rounded-2xl bg-slate-50 ring-1 ring-slate-200 px-4 py-3">
            <app-rating [rating]="completedMunro.rating" (ratingChange)="onRatingChanged($event)"></app-rating>
          </div>
        </div>

        <!-- Photo Upload -->
        <div>
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3">
            <h2 class="text-sm sm:text-base font-semibold text-slate-900">Hike Photos</h2>

            <button type="button" class="inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full
                         bg-slate-100 text-slate-900
                         hover:bg-slate-200 transition text-sm font-medium
                         w-full sm:w-auto" (click)="photoInput.click()">
              <i class="fa-solid fa-upload text-sm"></i>
              Upload Photos
            </button>

            <input #photoInput type="file" accept="image/*" multiple class="hidden"
              (change)="onPhotosSelected($event)" />
          </div>

          <!-- Photo Grid -->
          <div *ngIf="completedMunro.summitImages?.length || selectedPhotos?.length; else noPhotos">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4">
              <ng-container *ngFor="let img of completedMunro.summitImages || []">
                <div class="relative group rounded-2xl overflow-hidden bg-slate-100 cursor-pointer"
                  (click)="openPhoto(img)">
                  <img [src]="img" alt="Summit hike photo"
                    class="w-full h-28 object-cover transition-transform duration-300 group-hover:scale-[1.03]" />
                  <div class="absolute inset-0 bg-black/25 opacity-0 group-hover:opacity-100
                               flex items-center justify-center transition">
                    <i class="fa-solid fa-up-right-and-down-left-from-center text-white text-lg"></i>
                  </div>
                </div>
              </ng-container>

              <ng-container *ngFor="let photo of selectedPhotos || []">
                <div class="relative group rounded-2xl overflow-hidden bg-slate-100 cursor-pointer"
                  (click)="openPhoto(photo.preview)">
                  <img [src]="photo.preview" alt="Selected hike photo"
                    class="w-full h-28 object-cover transition-transform duration-300 group-hover:scale-[1.03]" />
                  <div class="absolute inset-0 bg-black/25 opacity-0 group-hover:opacity-100
                               flex items-center justify-center transition">
                    <i class="fa-solid fa-up-right-and-down-left-from-center text-white text-lg"></i>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <ng-template #noPhotos>
            <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 px-4 py-10">
              <div class="flex flex-col items-center text-slate-500 text-center">
                <i class="fa-solid fa-camera text-xl mb-2 text-slate-400"></i>
                <span class="text-sm">You haven't added any photos from this hike yet.</span>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Buttons (Uber/Airbnb-ish: solid primary + flat secondaries) -->
        <div class="space-y-2 pt-2">
          <button type="submit" class="w-full inline-flex items-center justify-center rounded-2xl
                       bg-slate-900 text-white py-3 font-semibold
                       hover:bg-slate-800 transition" (click)="saveCompletedMunro()">
            @if (munroSaving) {
            <app-loading-indicator [spinner]="true"></app-loading-indicator>
            } @else { Save }
          </button>

          <button *ngIf="!isNewCompletedMunro" type="button" (click)="removeCompletedMunro()" class="w-full inline-flex items-center justify-center rounded-2xl
                       bg-slate-100 text-slate-900 py-3 font-semibold
                       hover:bg-slate-200 transition">
            Mark as incomplete
          </button>

          <button type="button" (click)="editMode = false" class="w-full inline-flex items-center justify-center rounded-2xl
                       bg-transparent text-slate-600 py-3 font-semibold
                       hover:text-slate-900 hover:bg-slate-50 transition">
            Cancel
          </button>
        </div>
      </form>
      } @else {
      <!-- View Mode -->
      <div class="space-y-7">
        <!-- Notes -->
        <div>
          <div class="text-sm font-medium text-slate-800 mb-2">Notes</div>
          <div class="bg-slate-50 text-slate-900 text-sm rounded-2xl px-4 py-3 min-h-[56px] ring-1 ring-slate-200">
            {{ completedMunro.notes || 'No notes added.' }}
          </div>
        </div>

        <!-- Rating -->
        <div>
          <div class="text-sm font-medium text-slate-800 mb-2">Rating</div>
          <div class="inline-flex items-center rounded-2xl bg-slate-50 ring-1 ring-slate-200 px-4 py-3">
            <app-rating [rating]="completedMunro.rating" [readonly]="true"></app-rating>
          </div>
        </div>

        <!-- Photos -->
        <div>
          <div class="text-sm font-medium text-slate-800 mb-2">Hike Photos</div>
          <div *ngIf="completedMunro.summitImages?.length; else noViewPhotos">
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 sm:gap-4">
              <ng-container *ngFor="let img of completedMunro.summitImages">
                <div class="relative group rounded-2xl overflow-hidden bg-slate-100 cursor-pointer"
                  (click)="openPhoto(img)">
                  <img [src]="img" alt="Summit photo"
                    class="w-full h-28 object-cover transition-transform duration-300 group-hover:scale-[1.03]" />
                  <div class="absolute inset-0 bg-black/25 opacity-0 group-hover:opacity-100
                               flex items-center justify-center transition">
                    <i class="fa-solid fa-up-right-and-down-left-from-center text-white text-lg"></i>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <ng-template #noViewPhotos>
            <div class="rounded-2xl bg-slate-50 ring-1 ring-slate-200 px-4 py-10">
              <div class="flex flex-col items-center text-slate-500 text-center">
                <i class="fa-solid fa-camera text-xl mb-2 text-slate-400"></i>
                <span class="text-sm">No photos added yet.</span>
              </div>
            </div>
          </ng-template>
        </div>

        <!-- Edit Button -->
        <div class="pt-2">
          <button type="button" class="w-full inline-flex items-center justify-center rounded-2xl
                       bg-slate-900 text-white py-3 font-semibold
                       hover:bg-slate-800 transition" (click)="editMode = true">
            {{ isNewCompletedMunro ? 'Mark as complete' : 'Edit' }}
          </button>
        </div>
      </div>
      }

      <!-- Expanded Photo Modal -->
      @if (expandedPhoto) {
      <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4" (click)="closePhoto()">
        <div class="relative w-full max-w-md sm:max-w-4xl h-[65vh] flex items-center justify-center"
          (click)="$event.stopPropagation()">
          <button (click)="closePhoto()" class="absolute top-3 right-3 z-10 inline-flex items-center justify-center
                       h-10 w-10 rounded-full bg-white/10 hover:bg-white/20 text-white transition">
            <i class="fa-solid fa-xmark text-lg"></i>
          </button>

          <div class="w-full h-full bg-cover bg-center rounded-3xl"
            [ngStyle]="{ 'background-image': 'url(' + expandedPhoto + ')' }"></div>
        </div>
      </div>
      }
    </div>
  </div>
</div>
}